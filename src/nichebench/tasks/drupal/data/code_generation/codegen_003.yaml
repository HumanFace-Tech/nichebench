id: drupal_code_003
context: |
  Project: "Iconify"
  Stack:
    - Drupal: 11.2.x
    - PHP: 8.2
    - DB: MariaDB 10.6 in prod; SQLite 3.45 locally
  Feature:
    - Introduce first-class SVG icon packs using Drupal 11's Icon API (YAML-based discovery).
    - Editors should place icons via a configurable Block and developers should have a Twig function to render icons.
  Operational constraints:
    - Icon packs must be discoverable via EXTENSION_NAME.icons.yml and live under libraries/ or module dirs.
    - Site operators can swap/extend packs between releases without code changes.
    - Admins can set global rendering mode (inline SVG vs sprite <use>), with cache correctness.
  Repo hints:
    - New custom module under web/modules/custom/iconify
  Acceptance notes:
    - Block is Layout Builder–friendly; config form allows pack + icon + size + optional accessible label
    - Twig function mirrors block behavior for developers
    - Tests ensure YAML discovery works and rendering is cache-safe
summary: Deliver an Icon API–powered system with a YAML-declared icon pack, a configurable Icon block, and a Twig function.
prompt: |
  Create a module that:
    - Declares at least one icon pack via EXTENSION_NAME.icons.yml and provides a few SVGs under libraries/
    - Offers a Block plugin to choose pack/icon/size/label and renders the icon safely (inline or sprite)
    - Exposes a Twig function {{ iconify('pack','icon', { size: 24, label: '...' }) }} with the same behavior
    - Provides an admin settings page to toggle rendering mode (inline vs sprite)
    - Ensures rendered output is cacheable and invalidated if packs/icons change
    - Includes automated tests (Kernel for discovery/resolution; Functional for block placement and rendering)
judge_checklist:
  - "Defines icon packs via EXTENSION_NAME.icons.yml using a supported extractor (path/svg/sprite) and valid sources"
  - "Stores SVG assets under libraries/ (or equivalent) and references them correctly from the icon pack"
  - "Block plugin with config form (dependent selects: pack → icon), persists configuration, and renders via a dedicated service/helper"
  - "Twig extension registers a function that returns a render array (not raw strings), preserving cacheability metadata"
  - "Rendering path sanitizes SVG content or builds safe <use> href for sprites; no unsafe DOM injection"
  - "Admin settings form toggles global mode; configuration schema defined; defaults installed"
  - "Cacheability handled: adds tags/contexts/max-age so that changing packs/icons invalidates placements; verify via response headers"
  - "Kernel test covers icon discovery and resolution; Functional test places the block and asserts rendered markup + cache headers"
  - "Services defined with DI; no Drupal:: calls in method bodies; typed properties/return types and PSR-12 compliance"
  - "Comprehensive PHPDoc on plugins/services; clear annotations (plugin IDs, admin labels) and route/menu definitions"
